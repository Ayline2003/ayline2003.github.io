<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <script type="text/javascript">
                async function send()
                {
                    var button = document.getElementById("butt");
                    button.disabled = true;
                    const http = new XMLHttpRequest();
                    const url = "https://discordapp.com/api/webhooks/705418507579424768/dL0sx6Xf0OzWyxBwMIb_gS5VaTDzUL3oq32JPXPM9MmG9MrBYJyrv0M6sdPDWKOM7QMg";
                    var method = "POST";
                    var msg = document.getElementById('msg').value;
                    if (document.getElementById("clear").checked)
                    {
                        document.getElementById('msg').value = "";
                    }
                    // this is client side verification aka super stupid but idc
                    msg = msg.replace(/@/g, "[at]");
                    msg = msg.replace(/(^|[^\n])\n{2}(?!\n)/g, "$1\n");
                    msg = msg.replace(/(?:(?:https?|ftp):\/\/|\b(?:[a-z\d]+\.))(?:(?:[^\s()<>]+|\((?:[^\s()<>]+|(?:\([^\s()<>]+\)))?\))+(?:\((?:[^\s()<>]+|(?:\(?:[^\s()<>]+\)))?\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))?/ig, "[links werden blockiert]");
                    var user = document.getElementById("name").value;
                    user = user + " (" + document.getElementById("id").value + ")";
                    http.open(method, url, true);
                    http.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                    http.send(JSON.stringify({"content" : msg, "username" : user, "avatar_url" : document.getElementById("avurl").value}));
                    await sleep(5000);
                    button.disabled = false;
                }
                function loaded()
                {
                    document.getElementById('msg').value = "";
                    if (document.cookie.split(';').filter(function(item) 
                    {
                        return item.trim().indexOf('id=') == 0
                    }).length) 
                    {
                        document.getElementById("id").value = getCookie("id");
                    }
                    else
                    {
                        document.cookie = "id=" + makeid(8) + "; expires=Fri, 31 Dec 9999 23:59:59 GMT";
                        document.getElementById("id").value = getCookie("id");                       
                    }
                }
                // https://stackoverflow.com/a/1349426
                function makeid(length) 
                {
                    var result           = '';
                    var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
                    var charactersLength = characters.length;
                    for ( var i = 0; i < length; i++ ) 
                    {
                        result += characters.charAt(Math.floor(Math.random() * charactersLength));
                    }
                    return result;
                }
                function getCookie(name) 
                {
                    var value = "; " + document.cookie;
                    var parts = value.split("; " + name + "=");
                    if (parts.length == 2) return parts.pop().split(";").shift();
                }
                // https://stackoverflow.com/a/179514
                function deleteAllCookies() 
                {
                    var cookies = document.cookie.split(";");
                    for (var i = 0; i < cookies.length; i++) 
                    {
                        var cookie = cookies[i];
                        var eqPos = cookie.indexOf("=");
                        var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
                        document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
                    }
                    location.reload(true);
                }
                function sleep(ms) 
                {
                    return new Promise(resolve => setTimeout(resolve, ms));
                }
            </script>
            <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
            <!-- title>Webhook sender für discord pls kill me</title -->
            <title>Discord Webhook Sender</title>
            <link rel="shortcut icon" type="image/x-icon" href="/discord-webhook-sender/favicon.ico">
            <!-- Global site tag (gtag.js) - Google Analytics -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=UA-121857377-2"></script>
            <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'UA-121857377-2');
            </script>

    </head>
    <body style="font-family: 'Roboto', sans-serif; background-color: aquamarine" onload="loaded()">
        <h1>Discord Webhook sender</h1>
        <h3><i>TEST Version</i></h3>
        <p>Nachricht</p>
        <textarea id="msg" cols="70" rows="7" maxlength="2000"></textarea>
        <!-- p>URL</p>
        <input id="url" type="text" size="136"><br -->
        <p>Name (optional)</p>
        <input id="name" type="text" size="60" maxlength="21"><br>
        <p>Avatar URL (optional)</p>
        <input id="avurl" type="text" size="105"><br><br>
        <button id="butt"onclick="send()">Senden</button>
        <p>Nachrichten Textbox beim senden löschen <input type="checkbox" id="clear" checked> </p>
        <br><br><br><br><br><br><br><br><br><br>
        <p>Deine ID</p>
        <input readonly type="text" id="id" size="8">
        <button id="cookieDEL"onclick="deleteAllCookies()">Neue ID generieren</button><i> Die ID wird als Cookie gespeichert</i>
        <br>

    </body>
</html>
